{% extends "base.html" %}

{% block content %}
<h3 class="mb-4">Employee Analytics</h3>

<div class="row">

  <div class="col-md-6 mb-4">
    <div class="card p-3 shadow-sm">
      <h6 class="text-center">Department Count</h6>
      <canvas id="deptCountChart"></canvas>
    </div>
  </div>

  <div class="col-md-6 mb-4">
    <div class="card p-3 shadow-sm">
      <h6 class="text-center">Average Salary by Department</h6>
      <canvas id="deptAvgChart"></canvas>
    </div>
  </div>

</div>

<div class="row">
  
  <div class="col-md-6 mb-4">
    <div class="card p-3 shadow-sm">
      <h6 class="text-center">Top 5 Salaries</h6>
      <canvas id="top5Chart"></canvas>
    </div>
  </div>

  <div class="col-md-6 mb-4">
    <div class="card p-3 shadow-sm">
      <h6 class="text-center">Experience Distribution</h6>
      <canvas id="expChart"></canvas>
    </div>
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
fetch('/chart-data')
  .then(res => res.json())
  .then(data => {

    // Department Count (Pie)
    new Chart(document.getElementById('deptCountChart'), {
      type: 'pie',
      data: {
        labels: Object.keys(data.dept_counts),
        datasets: [{
          data: Object.values(data.dept_counts)
        }]
      }
    });

    // Department Average Salary (Bar)
    new Chart(document.getElementById('deptAvgChart'), {
      type: 'bar',
      data: {
        labels: Object.keys(data.dept_avg_salary),
        datasets: [{
          label: 'Avg Salary',
          data: Object.values(data.dept_avg_salary)
        }]
      }
    });

    // Top 5 Salaries (Horizontal Bar)
    new Chart(document.getElementById('top5Chart'), {
      type: 'bar',
      data: {
        labels: data.top5.map(x => x.name),
        datasets: [{
          label: 'Salary',
          data: data.top5.map(x => x.salary)
        }]
      },
      options: { indexAxis: 'y' }
    });

    // Experience Distribution (Bar)
    new Chart(document.getElementById('expChart'), {
      type: 'bar',
      data: {
        labels: Object.keys(data.exp_bins),
        datasets: [{
          label: 'Employees',
          data: Object.values(data.exp_bins)
        }]
      }
    });

  });
</script>

{% endblock %}
